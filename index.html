$(document).ready(function() {
    // Initial setup: Starting balance and diamond earning rate
    var startingDiamonds = 500;
    var earningRate = 5; // Earn 5 diamonds per interval
    var earningInterval = 1000; // 1 second interval for earning diamonds

    // Check if user is logged in when the page loads
    if (localStorage.getItem('username')) {
        $('#user-info').text('Logged in as ' + localStorage.getItem('username'));
        $('#logout-btn').show();
        $('#login-btn').hide();
        updateDiamondBalance();
        updateCryptoBalance();
    }

    // Toggle Sign Up form
    $('#signup-btn').click(function() {
        $('#signup-form').toggle();
        $('#login-form').hide(); // Hide Login form if it's visible
    });

    // Toggle Login form
    $('#login-btn').click(function() {
        $('#login-form').toggle();
        $('#signup-form').hide(); // Hide Sign Up form if it's visible
    });

    // Handle login form submission
    $('#login-form-element').submit(function(e) {
        e.preventDefault();
        var username = $('#login-username').val();
        var password = $('#login-password').val();

        var storedUsername = localStorage.getItem('username');
        var storedPassword = localStorage.getItem('password');

        // Check if the username and password match
        if (username === storedUsername && password === storedPassword) {
            // Successfully logged in
            $('#user-info').text('Logged in as ' + username);
            $('#login-form').hide();
            $('#logout-btn').show();
            $('#login-btn').hide();
            updateDiamondBalance();
            updateCryptoBalance();
        } else {
            alert('Invalid username or password.');
        }
    });

    // Handle sign-up form submission
    $('#signup-form-element').submit(function(e) {
        e.preventDefault();
        var username = $('#signup-username').val();
        var password = $('#signup-password').val();

        // Check if username already exists
        if (localStorage.getItem('username')) {
            alert('Account already exists. Please log in.');
            return;
        }

        if (username && password) {
            // Store the username and password in localStorage
            localStorage.setItem('username', username);
            localStorage.setItem('password', password);
            localStorage.setItem('diamonds', startingDiamonds); // Initialize diamond balance
            localStorage.setItem('crypto', JSON.stringify({})); // Initialize crypto balance
            alert('Account created successfully!');
            $('#signup-form').hide();
            $('#login-form').show();
        } else {
            alert('Please fill in both username and password.');
        }
    });

    // Handle logout functionality
    $('#logout-btn').click(function() {
        localStorage.removeItem('username');
        localStorage.removeItem('password');
        $('#user-info').text('Not logged in');
        $('#logout-btn').hide();
        $('#login-btn').show();
        $('#diamond-balance').text('Diamonds: 0');
        $('#crypto-balance').text('Crypto: LennonMartCoin 0, LennonGoodsCoin 0, MemeStationCoin 0, MemesmithCoin 0, MemesCarRentalsCoin 0, MemeHospitalCoin 0');
    });

    // Function to update diamond balance in the UI
    function updateDiamondBalance() {
        var diamonds = localStorage.getItem('diamonds') || 0;
        $('#diamond-balance').text('Diamonds: ' + diamonds);
    }

    // Function to update crypto balance in the UI
    function updateCryptoBalance() {
        var crypto = JSON.parse(localStorage.getItem('crypto')) || {};
        var cryptoText = 'Crypto: ';
        for (var key in crypto) {
            cryptoText += key + ' ' + crypto[key] + ', ';
        }
        $('#crypto-balance').text(cryptoText.slice(0, -2)); // Remove the last comma and space
    }

    // Function to earn diamonds over time
    setInterval(function() {
        if (localStorage.getItem('username')) {
            var diamonds = parseInt(localStorage.getItem('diamonds')) || 0;
            diamonds += earningRate;
            localStorage.setItem('diamonds', diamonds);
            updateDiamondBalance();
        }
    }, earningInterval);
});
